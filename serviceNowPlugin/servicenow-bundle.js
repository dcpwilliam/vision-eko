var ServiceNowAPI=(()=>{var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var l=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var f=(t,e)=>{for(var n in e)c(t,n,{get:e[n],enumerable:!0})},$=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of l(e))!y.call(t,o)&&o!==n&&c(t,o,{get:()=>e[o],enumerable:!(r=d(e,o))||r.enumerable});return t};var m=t=>$(c({},"__esModule",{value:!0}),t);var _={};f(_,{createChange:()=>I,createIncident:()=>g,orderCatalogItem:()=>T,searchKnowledge:()=>x,snowFetch:()=>a});async function a(t,e="GET",n){let{snowUrl:r,authType:o,oauthToken:p,username:u,password:w}=await chrome.storage.sync.get(["snowUrl","authType","oauthToken","username","password"]);if(!r)throw new Error("\u672A\u914D\u7F6E ServiceNow \u5B9E\u4F8B\u5730\u5740");let i={"Content-Type":"application/json",Accept:"application/json"};if(o==="oauth"&&p)i.Authorization=`Bearer ${p}`;else if(o==="basic"&&u&&w)i.Authorization="Basic "+btoa(`${u}:${w}`);else throw new Error("\u672A\u914D\u7F6E\u6709\u6548\u7684\u8BA4\u8BC1\u65B9\u5F0F");let s=await fetch(`${r}${t}`,{method:e,headers:i,body:n?JSON.stringify(n):void 0});if(!s.ok){let h=await s.text().catch(()=>"");throw new Error(`ServiceNow API \u9519\u8BEF: ${s.status} ${h}`)}return s.json()}async function g({short_description:t,description:e,urgency:n="3",impact:r="3",category:o="inquiry"}){return a("/api/now/table/incident","POST",{short_description:t,description:e,urgency:n,impact:r,category:o})}async function T({itemSysId:t,variables:e={}}){return a(`/api/sn_sc/servicecatalog/items/${t}/order_now`,"POST",{variables:e})}async function x({query:t,limit:e=5}){return a(`/api/now/table/kb_knowledge?sysparm_query=short_descriptionLIKE${encodeURIComponent(t)}^ORtextLIKE${encodeURIComponent(t)}&sysparm_limit=${e}`)}async function I({short_description:t,description:e,type:n="standard"}){return a("/api/now/table/change_request","POST",{short_description:t,description:e,type:n})}return m(_);})();
self.createIncident=ServiceNowAPI.createIncident;self.orderCatalogItem=ServiceNowAPI.orderCatalogItem;self.searchKnowledge=ServiceNowAPI.searchKnowledge;self.createChange=ServiceNowAPI.createChange;
